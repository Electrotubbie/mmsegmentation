# Инструкция по установке проекта

Для установки необходимых пакетов при работе с проектом необходимо выполнить следующие команды из директории mmsegmentation/urfu_project:

```sh
./train.py # происходит развёртывание venv и загрузка в неё необходимых пакетов
source .venv/bin/activate # меняем глобальную среду на venv
```
# Требования к наборам данных

## Структура

Датасет иметь следующую структуру:
```
/dataset
    /images
        img1.tif
        img2.tif
        img3.tif
        img4.tif
    /gt
        img1.tif
        img2.tif
        img3.tif
        img4.tif
    /splits
        train.txt
        val.txt
```
Файлы `train.txt` и `val.txt` содержат списки изображений для train и val наборов. Например:

`img1.tif` и `img3.tif` принадлежат train набору, тогда `train.txt` будет содержать следующее:
```
img1
img3
```
А `val.txt` в таком случае будет таким:
```
img2
img4
``` 

## Требования к изображениям масок в директории gt

Наши текущие наборы при чтении их через библиотеку `PIL` и преобразовании их в `np.array` передают цвет пикселя в формате 0/255.

При работе с mmsegmentation необходимо, чтоб изображения при преобразовании их в массив `np.array` передавали индекс класса из палитры, которую необходимо настраивать в файле [dataset.py](./dataset.py), а не цвет в ч/б формате. Поэтому преобразовать такие файлы можно через функцию `add_palette_for_1ch_img` из файла [aux_tools.py](./aux_tools.py).

Пример:
```python
>>> import numpy as np
>>> from PIL import Image
>>> np.array(Image.open('./M-33-20-D-c-4-2_16_no_p.tif')) # файл без палитры
array([[  0,   0,   0, ...,   0,   0,   0],
       [  0,   0,   0, ...,   0,   0,   0],
       [  0,   0,   0, ...,   0,   0,   0],
       ...,
       [128, 128, 128, ..., 128, 128, 128],
       [128, 128, 128, ..., 128, 128, 128],
       [128, 128, 128, ..., 128, 128, 128]], dtype=uint8)
>>> np.array(Image.open('./M-33-20-D-c-4-2_16_p.png')) # файл с палитрой
array([[0, 0, 0, ..., 0, 0, 0],
       [0, 0, 0, ..., 0, 0, 0],
       [0, 0, 0, ..., 0, 0, 0],
       ...,
       [2, 2, 2, ..., 2, 2, 2],
       [2, 2, 2, ..., 2, 2, 2],
       [2, 2, 2, ..., 2, 2, 2]], dtype=uint8)
>>> Image.open('./M-33-20-D-c-4-2_16_p.png').palette.colors
{(0, 64, 128): 0, 
(192, 255, 0): 1, 
(0, 0, 0): 2, 
(0, 0, 64): 85, 
(128, 192, 255): 86, 
(64, 128, 192): 171, 
(255, 0, 0): 172}
```



# Инструкция по работе с файлом конфигурации обучения config.py

Файл находится в директории urfu_project/configs.py

# Инструкция по запуску обучения

Из директории с проектом `urfu_project` выполните следующую команду
```sh
python3 ./train.py ./configs/config.py
```